<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <link
      rel="icon"
      sizes="32x32"
      href="favicon-32.png"
    />

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400..800&display=swap');

      html {
        background-color: #caa5e5;
      }

      body {
        font-family: Roboto, system-ui, sans-serif;
        margin: 0;
        padding: 0;
        background: radial-gradient(circle farthest-side at 100% -50%,#6b7cff96,transparent),radial-gradient(circle farthest-side at 90% -50%,#f582e2e0,transparent),radial-gradient(circle farthest-side at 80% -50%,#f7eaa6,white);
        color: #333;
      }

      h1, h2, h3, h4, h5, legend {
        font-family: 'Syne', sans-serif;
        line-height: 1.75;
      }

      form {
        display: flex;
        flex-flow: row wrap;
        gap: 1em;
        padding: 1em;
      }
      fieldset {
        background: #fff6;
        border: 1px solid #ccc;
        border-radius: 0.5em;
        width: 50ch;
      }
      legend {
        background: #f0f0f0;
        border: 1px solid #ccc;
        font-weight: bold;
        padding: 0.25em 1em;
      }
      slider-input {
        margin: 0 0.5em;
      }
      form .container {
        padding-left: 2em;
      }

      #output {
        background: #0009;
        backdrop-filter: blur(15px);
        color: #ddd;
        border: 1px solid #0006;
        border-radius: 0.5em;
        box-shadow: 0 2px 12px #0009;
        padding: 1em;
        width: max-content;
        margin: 1em auto;
        position: sticky;
        bottom: 0;
      }
    </style>

    <script type="module">
      import main from "./main.js"
      main()
    </script>
  </head>

  <body>
    <template id="slider-input-template">
      <style>
        label {
          display: grid;
          grid-template:
            "label label" auto
            "range number" auto
            / 1fr max-content;
          column-gap: 1em;
          align-items: center;
        }
        label > .label {
          grid-area: label;
        }
        label > .range {
          grid-area: range;
        }
        label > .number {
          grid-area: number;
          text-align: right;
        }
        input[type="number"] {
          min-width: 6ch;
          text-align: right;
        }
      </style>
      <label>
        <div class="label"><slot></slot></div>
        <input class="range" type="range" min="0" max="100" value="50">
        <div class="number">
          <span class="prefix"></span>
          <input type="number" min="0" max="100" value="50">
          <span class="suffix"></span>
        </div>
      </label>
    </template>

    <h1>Psychedelics Assisted Therapy Calculator</h1>

    <p>
      This calculator is designed to help you determine the cost of PAT.
    </p>

    <form>
      <fieldset>
        <legend>Study</legend>
        <slider-input name="participants" min="1" max="100" value="20" required>
          Total number of participants:
        </slider-input>
      </fieldset>

      <fieldset>
        <legend>Preparation</legend>
        <slider-input name="prep_hours" step="0.5" min="0" max="10" value="2" required>
          Total hours of preparation sessions:
        </slider-input>
        <slider-input name="licensed_therapists_prep" min="0" max="4" value="1" required>
          # of licensed therapists present for each preparation session:
        </slider-input>
        <slider-input name="unlicensed_therapists_prep" min="0" max="4" value="0" required>
          # of unlicensed therapists present for each preparation session:
        </slider-input>
        <slider-input name="patients_prep" min="1" max="10" value="1" required>
          # of patients in each preparation session:
        </slider-input>
      </fieldset>

      <fieldset>
        <legend>Drug Administration</legend>
        <label>
          Psychedelic Drug Administration Session:
          <select name="drug_type" required>
            <option value="mdma" data-hours="6">MDMA with booster dose - 6 hours</option>
            <option value="psilocybin" data-hours="8" selected>Psilocybin - 8 hours</option>
            <option value="iv_psilocin" data-hours="2">IV psilocin – 2 hours</option>
            <option value="lsd" data-hours="24">LSD - 24 hours</option>
            <option value="5meo" data-hours="1.5">5MeO - 90 min</option>
            <option value="dmt" data-hours="0.5">Inhaled N, N DMT – 30 min</option>
            <option value="ibogaine" data-hours="72">Ibogaine - 72 hours</option>
          </select>
        </label>
        <br>
        <slider-input name="drug_hours" min="0" step="0.5" max="48" value="8" required suffix="hours">
          Anticipated length of drug administration session:
        </slider-input>
        <slider-input name="drug_sessions" min="1" max="10" value="2" required>
          # of drug administration sessions:
        </slider-input>

        <slider-input name="licensed_therapists_drug" min="0" max="4" value="1" required>
          # of licensed therapists present for first drug administration session:
        </slider-input>
        <div class="container licensed_therapists_hours"></div>
        <template class="licensed_therapists_hours">
          <slider-input name="licensed_therapists_hours" min="1" max="48" value="8" required>
            Hours licensed therapist <span class="number"></span> present for each drug administration session:
          </slider-input>
        </template>

        <slider-input name="unlicensed_therapists_drug" min="0" max="4" value="0" required>
          # of unlicensed therapists present for drug administration session:
        </slider-input>
        <div class="container unlicensed_therapists_hours"></div>
        <template class="unlicensed_therapists_hours">
          <slider-input name="unlicensed_therapists_hours" min="1" max="48" value="8" required>
            Hours unlicensed therapist <span class="number"></span> present for each drug administration session:
          </slider-input>
        </template>

        <label>
          <input type="checkbox" name="physician_needed" checked />
          Physician/medical professional needed to be on call for drug administration session(s)
        </label>
        <br>
        <div class="physician_hours_container">
          <label>
            <input type="checkbox" name="different_sessions" />
            Is session duration or staffing requirements different for different administration sessions?
          </label>
          <div class="container physician_sessions"></div>
          <template class="physician_hours_multi">
            <slider-input name="physician_hours" min="1" max="48" value="8" required>
              How long must the physician/medical professional remain available for administration <span class="number"></span>?
            </slider-input>
          </template>
          <template class="physician_hours_single">
            <slider-input name="physician_hours" min="1" max="48" value="8" required>
              How long must the physician/medical professional remain available?
            </slider-input>
          </template>
        </div>

        <slider-input name="patients_drug" min="1" max="10" value="1" required>
          # of patients receiving drug simultaneously in each administration session:
        </slider-input>
      </fieldset>

      <fieldset>
        <legend>Integration</legend>
        <slider-input name="integration_hours" min="0" max="10" value="2" required>
          Total Hours of Integration Sessions:
        </slider-input>
        <slider-input name="licensed_therapists_integration" min="0" max="4" value="1" required>
          # of licensed therapists present for each integration session:
        </slider-input>
        <slider-input name="unlicensed_therapists_integration" min="0" max="4" value="0" required>
          # of unlicensed therapists present for each integration session:
        </slider-input>
        <slider-input name="patients_integration" min="1" max="10" value="1" required>
          # of patients in each integration session:
        </slider-input>
      </fieldset>

      <fieldset>
        <legend>Hourly Rates</legend>
        <slider-input name="rate_licensed" min="50" max="500" value="200" prefix="$" required>
          Hourly rate of licensed therapist:
        </slider-input>
        <slider-input name="rate_unlicensed" min="50" max="500" value="100" prefix="$" required>
          Hourly rate of unlicensed therapist:
        </slider-input>
        <slider-input name="rate_physician" min="50" max="500" value="300" prefix="$" required>
          Hourly rate of physician/medical professional:
        </slider-input>
      </fieldset>
    </form>

    <section id="output">
      <p>Total number of licensed therapist hours: <span id="total_licensed_hours"></span></p>
      <p>Total number of unlicensed therapist hours: <span id="total_unlicensed_hours"></span></p>
      <p>Total number of physician/medical professional hours: <span id="total_physician_hours"></span></p>
      <p>Total approximate labor cost: <strong>$<span id="total_cost"></span></strong></p>
    </section>
  </body>
</html>
